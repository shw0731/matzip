<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="review">
<typeAlias alias="review" type="review.ReviewVO"/>
<resultMap class="review" id="reviewRes">
<result column="reviewno" property="reviewNo"/>
<result column="restaurantno" property="restaurantNo"/>
<result column="ID" property="ID"/>
<result column="context" property="context"/>
<result column="images" property="images"/>
<result column="reg_date" property="reg_date"/>
<result column="sympathy" property="sympathy"/>
<result column="starpoint" property="starPoint"/>
<result column="subject" property="subject"/>
</resultMap>

<!-- 공통으로 사용할 select 절 정의 -->
<sql id="select-all">SELECT * FROM reviewboard </sql>

<!-- 공통으로 사용할 where-no 절 정의 -->
<sql id="where-no">WHERE reviewno = #reviewNo# </sql>

<!-- select 쿼리문 정의 -->
<select id="selectAll" parameterClass="int" resultMap="reviewRes">
	SELECT * FROM REVIEWBOARD WHERE restaurantNo = #restaurantNo# ORDER BY sympathy DESC, reg_date ASC
</select>
<select id="selectOne" parameterClass="String" resultMap="reviewRes">
	SELECT REVIEWNO FROM REVIEWBOARD WHERE ID = #ID#
</select>
<!-- 평점계산 -->
<select id="AvgStarPoint" parameterClass="int" resultClass="float">
	SELECT ROUND(AVG(STARPOINT),2) FROM REVIEWBOARD WHERE RESTAURANTNO = #restaurantNo# 
</select>
<!-- insert 쿼리문 정의 -->
<insert id="insertReview" parameterClass="review">
INSERT INTO REVIEWBOARD(REVIEWNO,restaurantNO,SUBJECT,ID,CONTEXT,IMAGES,SYMPATHY,STARPOINT,REG_DATE)
VALUES (REVIEW_SEQ.NEXTVAL,#restaurantNo#,#subject#,#ID#,#context#,#images#,#sympathy#,#starPoint#,#reg_date#)
</insert>
<!-- update 쿼리문 정의 -->
<update id="updateReview" parameterClass="review">
UPDATE REVIEWBOARD SET SUBJECT = #subject#, CONTEXT = #context#, IMAGES = #images# , STARPOINT = #starPoint#
<include refid="where-no"/>
</update>
<!-- 사진 업로드 기능 -->
<update id="updateFile" parameterClass="review">
	UPDATE REVIEWBOARD SET 
	images=#images#
	<include refid="where-no"/>
</update>
<!-- 공감 기능 -->
<update id="increaseSympathy" parameterClass="int">
UPDATE REVIEWBOARD SET SYMPATHY = SYMPATHY+1
<include refid="where-no"/>
</update>
<!-- update sympathy-->


</sqlMap>