<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="likereg">
<typeAlias alias="like" type="LikeVO"/>
<!-- 리절트 맵 -->

<resultMap id="likeres" class="like">
  <result property="memberID" column="memberID"/>
  <result property="RestaurantNo" column="RestaurantNo"/>
</resultMap>

<select id="select-all">
SELECT * FROM LIKEREG 
</select>
<select id="select-no">
WHERE RESTAURANTNO=#RestaurentNo#
</select>
<select id="select-id">
WHERE MEMBERID=#memberID#
</select>

<select id="selectOne">
<include refid="select-all"/>
<include refid="select-no"/>
</select>

<!-- LIKEREG에서 선택한 음식점 게시판과 맞는 유저아이디, 유저아이디개수, 음식점게시판번호를 가져온다.  -->
<select id="like-rate" resultMap="likeres" parameterClass="like">
SELECT COUNT(MEMBERID) as "LIKERATE" 
FROM LIKEREG 
 <include refid="select-no"/>
</select>

<!-- 유저의 좋아요한 음식점 이름 목록보기 -->
<select id="like-list" resultMap="likeres" parameterClass="like">
SELECT RESTAURANTNAME FROM RESTAURANTBOARD WHERE RESTAURANTNO=(SELECT RESTAURANTNO FROM LIKEREG WHERE MEMBERID=#memberID#)
<!-- SELECT a.RESTAURANTNAME, b.memberID FROM RESTAURANTBOARD a, LIKEREG b WHERE a.RESTAURANTNO=b.RESTAURANTNO -->
</select>

<!-- LIKEREG에 유저아이디와 음식점 게시판번호를 입력한다 -->
<insert id="like-up" parameterClass="like">
INSERT INTO LIKEREG(MEMBERID, RESTAURANTNO)
VALUES(#memberID#, #RestaurantNo#)
</insert>

<!-- 선택한 음식점게시판번호와 맞는 유저아이디와 음식점 번호를 삭제한다. -->
<delete id="like-down" parameterClass="like">
DELETE FROM LIKEREG(MEMBERID, RESTAURANTNO) 
 <include refid="select-no"/>
 
</delete>
</sqlMap>
